!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bondage=t()}(this,(function(){"use strict";var e=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e,t){var s=function(){function e(e,t){var s;if(Object.defineProperty(this,"name",{enumerable:!1,writable:!1,value:"JisonParserError"}),null==e&&(e="???"),Object.defineProperty(this,"message",{enumerable:!1,writable:!0,value:e}),this.hash=t,t&&t.exception instanceof Error){var i=t.exception;this.message=i.message||e,s=i.stack}s||(Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):s=new Error(e).stack),s&&Object.defineProperty(this,"stack",{enumerable:!1,writable:!1,value:s})}function t(e,t,s){s=s||0;for(var i=0;i<t;i++)this.push(e),e+=s}function s(e,t){for(t+=e=this.length-e;e<t;e++)this.push(this[e])}function i(e){for(var t=[],s=0,i=e.length;s<i;s++){var n=e[s];"function"==typeof n?(s++,n.apply(t,e[s])):t.push(n)}return t}"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(e.prototype,Error.prototype):e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e.prototype.name="JisonParserError";var n={trace:function(){},JisonParserError:e,yy:{},options:{type:"slr",errorRecoveryTokenDiscardCount:3},symbols_:{$accept:0,$end:1,"%prec":33,Add:35,AddAssign:23,And:40,BeginCommand:4,BeginInlineExp:49,Comma:48,Dedent:13,Divide:38,DivideAssign:26,EOF:1,Else:8,ElseIf:9,EndCommand:6,EndIf:7,EndInlineExp:50,EndOfInput:3,EqualTo:42,EqualToOrAssign:22,False:28,GreaterThan:44,GreaterThanOrEqualTo:45,Identifier:14,If:5,Indent:12,LeftParen:15,LessThan:46,LessThanOrEqualTo:47,Minus:36,MinusAssign:24,Multiply:37,MultiplyAssign:25,Not:34,NotEqualTo:43,Null:31,Number:29,OptionDelimit:19,OptionEnd:18,OptionStart:17,Or:39,RightParen:16,Set:20,ShortcutOption:11,String:30,Text:10,True:27,UnaryMinus:32,Variable:21,Xor:41,additionalConditionalStatements:54,argument:65,assignment:60,conditionalStatement:53,error:2,expression:61,functionCall:57,functionResultExpression:62,inlineExpression:66,jump:58,node:51,openArguments:64,option:59,parenArguments:63,shortcut:56,statement:55,statements:52},terminals_:{1:"EOF",2:"error",3:"EndOfInput",4:"BeginCommand",5:"If",6:"EndCommand",7:"EndIf",8:"Else",9:"ElseIf",10:"Text",11:"ShortcutOption",12:"Indent",13:"Dedent",14:"Identifier",15:"LeftParen",16:"RightParen",17:"OptionStart",18:"OptionEnd",19:"OptionDelimit",20:"Set",21:"Variable",22:"EqualToOrAssign",23:"AddAssign",24:"MinusAssign",25:"MultiplyAssign",26:"DivideAssign",27:"True",28:"False",29:"Number",30:"String",31:"Null",32:"UnaryMinus",33:"%prec",34:"Not",35:"Add",36:"Minus",37:"Multiply",38:"Divide",39:"Or",40:"And",41:"Xor",42:"EqualTo",43:"NotEqualTo",44:"GreaterThan",45:"GreaterThanOrEqualTo",46:"LessThan",47:"LessThanOrEqualTo",48:"Comma",49:"BeginInlineExp",50:"EndInlineExp"},TERROR:2,EOF:1,originalQuoteName:null,originalParseError:null,cleanupAfterParse:null,constructParseErrorInfo:null,yyMergeLocationInfo:null,__reentrant_call_depth:0,__error_infos:[],__error_recovery_infos:[],quoteName:function(e){return'"'+e+'"'},getSymbolName:function(e){if(this.terminals_[e])return this.terminals_[e];var t=this.symbols_;for(var s in t)if(t[s]===e)return s;return null},describeSymbol:function(e){if(e!==this.EOF&&this.terminal_descriptions_&&this.terminal_descriptions_[e])return this.terminal_descriptions_[e];if(e===this.EOF)return"end of input";var t=this.getSymbolName(e);return t?this.quoteName(t):null},collect_expected_token_set:function(e,t){var s=this.TERROR,i=[],n={};if(!t&&this.state_descriptions_&&this.state_descriptions_[e])return[this.state_descriptions_[e]];for(var r in this.table[e])if((r=+r)!==s){var o=t?r:this.describeSymbol(r);o&&!n[o]&&(i.push(o),n[o]=!0)}return i},productions_:function(e){for(var t=[],s=e.pop,i=e.rule,n=0,r=s.length;n<r;n++)t.push([s[n],i[n]]);return t}({pop:i([51,t,[52,4],53,53,t,[54,3],t,[55,7],56,56,t,[57,4],58,59,t,[60,5],t,[61,24],62,63,63,64,64,t,[65,7],66]),rule:i([t,[2,3],1,1,8,6,7,8,6,t,[1,7],5,9,3,5,6,4,s,[4,3],t,[6,4],t,[1,6],4,4,2,t,[3,14],1,4,3,1,s,[55,3],t,[1,6],3])}),performAction:function(e,t,s,i,n){var r=this.yy,o=r.parser;switch(r.lexer,t){case 0:
/*! Production::    $accept : node $end */
this.$=i[s-1],this._$=n[s-1];break;case 1:
/*! Production::    node : statements EndOfInput */return this.$=i[s-1],this._$=o.yyMergeLocationInfo(s-1,s),JSON.stringify(i[s-1],null,"  "),i[s-1];case 2:
/*! Production::    statements : statements conditionalStatement */case 3:
/*! Production::    statements : statements statement */case 58:
/*! Production::    openArguments : openArguments argument */
this._$=o.yyMergeLocationInfo(s-1,s),this.$=i[s-1].concat([i[s]]);break;case 4:
/*! Production::    statements : conditionalStatement */case 5:
/*! Production::    statements : statement */case 57:
/*! Production::    parenArguments : argument */case 59:
/*! Production::    openArguments : argument */
this._$=n[s],this.$=[i[s]];break;case 6:
/*! Production::    conditionalStatement : BeginCommand If expression EndCommand statements BeginCommand EndIf EndCommand */
this._$=o.yyMergeLocationInfo(s-7,s),this.$=new r.IfNode(i[s-5],i[s-3]);break;case 7:
/*! Production::    conditionalStatement : BeginCommand If expression EndCommand statements additionalConditionalStatements */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.IfElseNode(i[s-3],i[s-1],i[s]);break;case 8:
/*! Production::    additionalConditionalStatements : BeginCommand Else EndCommand statements BeginCommand EndIf EndCommand */
this._$=o.yyMergeLocationInfo(s-6,s),this.$=new r.ElseNode(i[s-3]);break;case 9:
/*! Production::    additionalConditionalStatements : BeginCommand ElseIf expression EndCommand statements BeginCommand EndIf EndCommand */
this._$=o.yyMergeLocationInfo(s-7,s),this.$=new r.ElseIfNode(i[s-5],i[s-3]);break;case 10:
/*! Production::    additionalConditionalStatements : BeginCommand ElseIf expression EndCommand statements additionalConditionalStatements */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.ElseIfNode(i[s-3],i[s-1],i[s]);break;case 11:
/*! Production::    statement : shortcut */case 12:
/*! Production::    statement : functionCall */case 13:
/*! Production::    statement : jump */case 14:
/*! Production::    statement : option */case 15:
/*! Production::    statement : assignment */case 17:
/*! Production::    statement : inlineExpression */case 54:
/*! Production::    expression : functionResultExpression */
this._$=n[s],this.$=i[s];break;case 16:
/*! Production::    statement : Text */
this._$=n[s],this.$=new r.TextNode(i[s],this._$);break;case 18:
/*! Production::    shortcut : ShortcutOption Text Indent statements Dedent */
this._$=o.yyMergeLocationInfo(s-4,s),this.$=new r.DialogShortcutNode(i[s-3],i[s-1],this._$);break;case 19:
/*! Production::    shortcut : ShortcutOption Text BeginCommand If expression EndCommand Indent statements Dedent */
this._$=o.yyMergeLocationInfo(s-8,s),this.$=new r.ConditionalDialogShortcutNode(i[s-7],i[s-1],i[s-4],this._$);break;case 20:
/*! Production::    functionCall : BeginCommand Identifier EndCommand */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.FunctionResultNode(i[s-1],[]);break;case 21:
/*! Production::    functionCall : BeginCommand Identifier LeftParen RightParen EndCommand */
this._$=o.yyMergeLocationInfo(s-4,s),this.$=new r.FunctionResultNode(i[s-3],[]);break;case 22:
/*! Production::    functionCall : BeginCommand Identifier LeftParen parenArguments RightParen EndCommand */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.FunctionResultNode(i[s-4],i[s-2]);break;case 23:
/*! Production::    functionCall : BeginCommand Identifier openArguments EndCommand */
this._$=o.yyMergeLocationInfo(s-3,s),this.$=new r.FunctionResultNode(i[s-2],i[s-1]);break;case 24:
/*! Production::    jump : OptionStart Text OptionEnd */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.JumpNode(i[s-1],this._$);break;case 25:
/*! Production::    option : OptionStart Text OptionDelimit Identifier OptionEnd */
this._$=o.yyMergeLocationInfo(s-4,s),this.$=new r.OptionNode(i[s-3],i[s-1],this._$);break;case 26:
/*! Production::    assignment : BeginCommand Set Variable EqualToOrAssign expression EndCommand */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.SetVariableEqualToNode(i[s-3].substring(1),i[s-1]);break;case 27:
/*! Production::    assignment : BeginCommand Set Variable AddAssign expression EndCommand */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.SetVariableAddNode(i[s-3].substring(1),i[s-1]);break;case 28:
/*! Production::    assignment : BeginCommand Set Variable MinusAssign expression EndCommand */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.SetVariableMinusNode(i[s-3].substring(1),i[s-1]);break;case 29:
/*! Production::    assignment : BeginCommand Set Variable MultiplyAssign expression EndCommand */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.SetVariableMultipyNode(i[s-3].substring(1),i[s-1]);break;case 30:
/*! Production::    assignment : BeginCommand Set Variable DivideAssign expression EndCommand */
this._$=o.yyMergeLocationInfo(s-5,s),this.$=new r.SetVariableDivideNode(i[s-3].substring(1),i[s-1]);break;case 31:
/*! Production::    expression : True */case 32:
/*! Production::    expression : False */case 64:
/*! Production::    argument : True */case 65:
/*! Production::    argument : False */
this._$=n[s],this.$=new r.BooleanLiteralNode(i[s]);break;case 33:
/*! Production::    expression : Number */case 61:
/*! Production::    argument : Number */
this._$=n[s],this.$=new r.NumericLiteralNode(i[s]);break;case 34:
/*! Production::    expression : String */case 62:
/*! Production::    argument : String */
this._$=n[s],this.$=new r.StringLiteralNode(i[s]);break;case 35:
/*! Production::    expression : Null */case 66:
/*! Production::    argument : Null */
this._$=n[s],this.$=new r.NullLiteralNode(i[s]);break;case 36:
/*! Production::    expression : Variable */case 63:
/*! Production::    argument : Variable */
this._$=n[s],this.$=new r.VariableNode(i[s].substring(1));break;case 37:
/*! Production::    expression : UnaryMinus Number "%prec" UnaryMinus */
this._$=o.yyMergeLocationInfo(s-3,s),this.$=new r.UnaryMinusExpressionNode(i[s-2]);break;case 38:
/*! Production::    expression : UnaryMinus Variable "%prec" UnaryMinus */
this._$=o.yyMergeLocationInfo(s-3,s),this.$=new r.UnaryMinusExpressionNode(i[s-2].substring(1));break;case 39:
/*! Production::    expression : Not expression */
this._$=o.yyMergeLocationInfo(s-1,s),this.$=new r.NegatedBooleanExpressionNode(i[s]);break;case 40:
/*! Production::    expression : LeftParen expression RightParen */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.ArithmeticExpressionNode(i[s-1]);break;case 41:
/*! Production::    expression : expression Add expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.ArithmeticExpressionAddNode(i[s-2],i[s]);break;case 42:
/*! Production::    expression : expression Minus expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.ArithmeticExpressionMinusNode(i[s-2],i[s]);break;case 43:
/*! Production::    expression : expression Multiply expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.ArithmeticExpressionMultiplyNode(i[s-2],i[s]);break;case 44:
/*! Production::    expression : expression Divide expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.ArithmeticExpressionDivideNode(i[s-2],i[s]);break;case 45:
/*! Production::    expression : expression Or expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.BooleanOrExpressionNode(i[s-2],i[s]);break;case 46:
/*! Production::    expression : expression And expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.BooleanAndExpressionNode(i[s-2],i[s]);break;case 47:
/*! Production::    expression : expression Xor expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.BooleanXorExpressionNode(i[s-2],i[s]);break;case 48:
/*! Production::    expression : expression EqualTo expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.EqualToExpressionNode(i[s-2],i[s]);break;case 49:
/*! Production::    expression : expression NotEqualTo expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.NotEqualToExpressionNode(i[s-2],i[s]);break;case 50:
/*! Production::    expression : expression GreaterThan expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.GreaterThanExpressionNode(i[s-2],i[s]);break;case 51:
/*! Production::    expression : expression GreaterThanOrEqualTo expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.GreaterThanOrEqualToExpressionNode(i[s-2],i[s]);break;case 52:
/*! Production::    expression : expression LessThan expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.LessThanExpressionNode(i[s-2],i[s]);break;case 53:
/*! Production::    expression : expression LessThanOrEqualTo expression */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.LessThanOrEqualToExpressionNode(i[s-2],i[s]);break;case 55:
/*! Production::    functionResultExpression : Identifier LeftParen parenArguments RightParen */
this._$=o.yyMergeLocationInfo(s-3,s),this.$=new r.FunctionResultNode(i[s-3],i[s-1]);break;case 56:
/*! Production::    parenArguments : parenArguments Comma argument */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=i[s-2].concat([i[s]]);break;case 60:
/*! Production::    argument : Identifier */
this._$=n[s],this.$=new r.TextNode(i[s]);break;case 67:
/*! Production::    inlineExpression : BeginInlineExp expression EndInlineExp */
this._$=o.yyMergeLocationInfo(s-2,s),this.$=new r.InlineExpressionNode(i[s-1],this._$)}},table:function(e){for(var t=[],s=e.len,i=e.symbol,n=e.type,r=e.state,o=e.mode,a=e.goto,l=0,h=s.length;l<h;l++){for(var u=s[l],d={},c=0;c<u;c++){var p=i.shift();switch(n.shift()){case 2:d[p]=[o.shift(),a.shift()];break;case 0:d[p]=r.shift();break;default:d[p]=[3]}}t.push(d)}return t}({len:i([14,1,14,0,0,3,t,[0,7],1,1,12,t,[0,3],12,11,1,2,2,s,[22,3],t,[0,4],2,12,12,0,s,[34,3],10,9,t,[0,8],5,14,1,0,1,0,t,[12,13],1,1,0,14,9,14,1,2,s,[59,4],t,[12,4],14,12,1,16,16,0,0,t,[16,9],s,[32,3],s,[79,3],1,8,t,[14,5],0,s,[89,5],6,t,[0,8],t,[1,3],12,s,[20,3],14,14,13,14,0,4,14,1,s,[24,3],1,0]),symbol:i([4,10,11,17,49,52,53,t,[55,6,1],66,1,3,s,[16,5],s,[15,8],5,14,20,10,10,14,15,21,t,[27,6,1],34,61,62,s,[12,12],6,s,[13,8],64,65,21,4,12,18,19,t,[35,13,1],50,21,29,s,[56,24],15,6,s,[42,13],14,16,s,[27,6],63,65,6,14,s,[10,6],65,t,[22,5,1],s,[153,14],5,14,s,[79,24],s,[12,132],33,33,16,s,[212,14],s,[211,8],s,[197,14],6,16,48,s,[102,60],s,[77,3],13,s,[412,10],s,[26,12],18,6,s,[128,14],50,s,[16,160],32,32,16,48,s,[618,6],t,[54,7,1],66,s,[509,9],s,[542,14],s,[14,70],5,7,8,9,14,20,12,6,s,[691,9],s,[335,7],s,[412,11],s,[426,15],s,[63,13],s,[377,14],s,[802,13],s,[678,15],7,14,20,s,[215,15],s,[123,6],6]),type:i([t,[2,5],t,[0,9],1,t,[2,6],t,[0,8],t,[2,15],s,[17,12],s,[12,11],s,[40,17],t,[2,16],s,[56,23],s,[37,24],s,[46,13],s,[138,19],s,[79,24],s,[12,132],s,[211,20],s,[197,21],s,[102,57],s,[77,18],s,[384,33],t,[2,155],s,[284,17],s,[204,104],s,[412,21],s,[426,22],s,[171,15],s,[13,26],s,[787,12],s,[18,15]]),state:i([2,3,4,t,[6,5,1],12,17,18,s,[8,6],24,34,36,34,39,40,69,34,70,34,74,75,77,83,s,[30,8],86,34,87,34,88,34,89,34,90,34,91,34,92,34,93,34,94,34,95,34,96,34,97,34,98,34,102,75,103,s,[37,8],107,34,108,34,109,34,110,34,111,34,s,[77,8],113,34,17,119,s,[11,7],121,134,34,135,s,[41,8],136,s,[117,16],s,[8,8],140,s,[25,9],143,s,[18,7]]),mode:i([t,[1,357],t,[2,4],s,[6,6],t,[2,10],s,[16,14],s,[38,5],s,[47,11],s,[7,6],s,[16,16],s,[17,7],s,[16,10],s,[64,14],s,[16,73],t,[1,177]]),goto:i([5,11,t,[13,4,1],s,[6,5],t,[19,5,1],35,33,30,t,[25,5,1],31,32,s,[10,10],37,41,38,44,45,46,42,43,47,48,50,49,51,52,t,[54,13,1],53,68,67,s,[50,20],71,72,s,[38,13],41,73,s,[64,6],76,41,s,[8,6],t,[78,5,1],s,[116,5],84,85,s,[63,20],s,[10,110],99,100,101,s,[174,14],s,[165,6],s,[160,5],104,105,106,s,[81,50],s,[58,3],112,14,15,s,[16,10],114,t,[41,4],56,57,t,[41,10],t,[42,4],56,57,t,[42,10],45,45,s,[129,4],45,s,[129,8],45,46,46,s,[16,4],46,46,s,[16,7],46,47,47,s,[16,4],t,[47,3],s,[16,6],47,48,48,s,[16,4],t,[48,10],49,49,s,[16,4],t,[49,10],50,50,s,[16,4],t,[50,10],51,51,s,[16,4],t,[51,10],52,s,[453,5],t,[52,10],53,t,[53,5,1],t,[53,10],115,116,117,106,118,s,[255,4],120,s,[268,7],122,s,[289,13],123,s,[14,13],124,s,[14,13],125,s,[14,13],126,s,[14,13],127,s,[14,13],19,128,129,130,20,21,131,132,133,s,[313,13],14,15,s,[5,5],137,s,[43,13],s,[19,3],138,14,15,139,s,[30,9],19,141,20,21,142,s,[9,4],144,19,145,s,[69,4],146])}),defaultActions:function(e){for(var t={},s=e.idx,i=e.goto,n=0,r=s.length;n<r;n++){t[s[n]]=i[n]}return t}({idx:i([3,4,t,[6,7,1],16,17,18,t,[25,6,1],34,37,t,[40,8,1],51,53,69,75,76,77,88,89,101,104,112,t,[114,4,1],t,[119,8,1],132,138,143,144,146]),goto:i([4,5,t,[11,7,1],1,2,3,t,[31,6,1],54,20,t,[59,8,1],24,67,39,57,23,58,43,44,40,21,18,25,37,38,55,7,22,56,t,[26,5,1],6,19,10,8,9])}),parseError:function(e,t,s){if(!t.recoverable)throw"function"==typeof this.trace&&this.trace(e),s||(s=this.JisonParserError),new s(e,t);"function"==typeof this.trace&&this.trace(e),t.destroy()},parse:function(e){var t,s=this,i=new Array(128),n=new Array(128),r=new Array(128),o=new Array(128),a=this.table,l=0,h=0;this.TERROR;var u=this.EOF;this.options.errorRecoveryTokenDiscardCount;var d,c=[0,147];d=this.__lexer__?this.__lexer__:this.__lexer__=Object.create(this.lexer);var p={parseError:void 0,quoteName:void 0,lexer:void 0,parser:void 0,pre_parse:void 0,post_parse:void 0,pre_lex:void 0,post_lex:void 0};function y(e){if("object"==typeof e){var t={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}return e}function f(e,t){for(var s in t)void 0===e[s]&&Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}function x(e){var t=y(e);return t&&t.range&&(t.range=t.range.slice(0)),t}function E(){var e=d.fastLex();return"number"!=typeof e&&(e=s.symbols_[e]||e),e||u}"function"!=typeof assert||assert,this.yyGetSharedState=function(){return p},f(p,this.yy),p.lexer=d,p.parser=this,"function"==typeof p.parseError?this.parseError=function(e,t,s){return s||(s=this.JisonParserError),p.parseError.call(this,e,t,s)}:this.parseError=this.originalParseError,"function"==typeof p.quoteName?this.quoteName=function(e){return p.quoteName.call(this,e)}:this.quoteName=this.originalQuoteName,this.cleanupAfterParse=function(e,t,s){var a,h;t&&((p.post_parse||this.post_parse)&&(h=this.constructParseErrorInfo(null,null,null,!1)),p.post_parse&&void 0!==(a=p.post_parse.call(this,p,e,h))&&(e=a),this.post_parse&&void 0!==(a=this.post_parse.call(this,p,e,h))&&(e=a),h&&h.destroy&&h.destroy());if(this.__reentrant_call_depth>1)return e;if(d.cleanupAfterLex&&d.cleanupAfterLex(s),p&&(p.lexer=void 0,p.parser=void 0,d.yy===p&&(d.yy=void 0)),p=void 0,this.parseError=this.originalParseError,this.quoteName=this.originalQuoteName,i.length=0,n.length=0,o.length=0,r.length=0,l=0,!s){for(var u=this.__error_infos.length-1;u>=0;u--){var c=this.__error_infos[u];c&&"function"==typeof c.destroy&&c.destroy()}this.__error_infos.length=0}return e},this.yyMergeLocationInfo=function(e,t,s,i,n){var r,a=0|e,h=0|t,u=s,d=i;if(!u&&null!=e)for(var c=a;c<=h&&!(u=o[c]);c++);if(!d&&null!=t)for(c=h;c>=a&&!(d=o[c]);c--);if(!u&&null==e){if(!n)for(c=(a||l)-1;c>=0&&!(u=o[c]);c--);return u?((r=y(u)).first_line=r.last_line,r.first_column=r.last_column,r.range&&(r.range=r.range.slice(0),r.range[0]=r.range[1]),d&&(f(r,d),r.last_line=d.last_line,r.last_column=d.last_column,r.range&&d.range&&(r.range[1]=d.range[1])),r):d?((r=y(d)).range&&(r.range=r.range.slice(0)),r):void 0}if(u||(u=d,d=null),u)return(r=y(u)).range&&(r.range=r.range.slice(0)),d&&(f(r,d),r.last_line=d.last_line,r.last_column=d.last_column,r.range&&d.range&&(r.range[1]=d.range[1])),r},this.constructParseErrorInfo=function(e,t,s,a){var u={errStr:e,exception:t,text:d.match,value:d.yytext,token:this.describeSymbol(h)||h,token_id:h,line:d.yylineno,loc:x(d.yylloc),expected:s,recoverable:a,state:m,action:g,new_state:L,symbol_stack:i,state_stack:n,value_stack:r,location_stack:o,stack_pointer:l,yy:p,lexer:d,parser:this,destroy:function(){var e=!!this.recoverable;for(var t in this)this.hasOwnProperty(t)&&"object"==typeof t&&(this[t]=void 0);this.recoverable=e}};return this.__error_infos.push(u),u};var m,g,N,T,b,_,v,L,O=function(){var e=d.lex();return"number"!=typeof e&&(e=s.symbols_[e]||e),e||u},I={$:!0,_$:void 0,yy:p},w=!1;try{if(this.__reentrant_call_depth++,d.setInput(e,p),"function"==typeof d.canIUse)d.canIUse().fastLex&&(O=E);for(t=d.yylloc,o[l]=t,r[l]=null,n[l]=0,i[l]=0,++l,this.pre_parse&&this.pre_parse.call(this,p),p.pre_parse&&p.pre_parse.call(this,p),L=n[l-1];;){if(m=L,this.defaultActions[m])g=2,L=this.defaultActions[m];else if(h||(h=O()),T=a[m]&&a[m][h]||c,L=T[1],!(g=T[0])){var $,A=this.describeSymbol(h)||h,k=this.collect_expected_token_set(m);$="number"==typeof d.yylineno?"Parse error on line "+(d.yylineno+1)+": ":"Parse error: ","function"==typeof d.showPosition&&($+="\n"+d.showPosition(69,10)+"\n"),k.length?$+="Expecting "+k.join(", ")+", got unexpected "+A:$+="Unexpected "+A,b=this.constructParseErrorInfo($,null,k,!1),void 0!==(N=this.parseError(b.errStr,b,this.JisonParserError))&&(w=N);break}switch(g){default:if(g instanceof Array){b=this.constructParseErrorInfo("Parse Error: multiple actions possible at state: "+m+", token: "+h,null,null,!1),void 0!==(N=this.parseError(b.errStr,b,this.JisonParserError))&&(w=N);break}b=this.constructParseErrorInfo("Parsing halted. No viable error recovery approach available due to internal system failure.",null,null,!1),void 0!==(N=this.parseError(b.errStr,b,this.JisonParserError))&&(w=N);break;case 1:i[l]=h,r[l]=d.yytext,o[l]=x(d.yylloc),n[l]=L,++l,h=0,t=d.yylloc;continue;case 2:if(_=(v=this.productions_[L-1])[1],void 0!==(N=this.performAction.call(I,t,L,l-1,r,o))){w=N;break}l-=_;var S=v[0];i[l]=S,r[l]=I.$,o[l]=I._$,L=a[n[l-1]][S],n[l]=L,++l;continue;case 3:-2!==l&&(w=!0,l--,void 0!==r[l]&&(w=r[l]))}break}}catch(e){if(e instanceof this.JisonParserError)throw e;if(d&&"function"==typeof d.JisonLexerError&&e instanceof d.JisonLexerError)throw e;b=this.constructParseErrorInfo("Parsing aborted due to exception.",e,null,!1),w=!1,void 0!==(N=this.parseError(b.errStr,b,this.JisonParserError))&&(w=N)}finally{w=this.cleanupAfterParse(w,!0,!0),this.__reentrant_call_depth--}return w}};function r(){this.yy={}}return n.originalParseError=n.parseError,n.originalQuoteName=n.quoteName,r.prototype=n,n.Parser=r,new r}();t.parser=s,t.Parser=s.Parser,t.parse=function(){return s.parse.apply(s,arguments)}}));var t={Whitespace:null,Indent:null,Dedent:null,EndOfLine:null,EndOfInput:null,UnaryMinus:null,Number:/-?[0-9]+(\.[0-9+])?/,String:/"([^"\\]*(?:\\.[^"\\]*)*)"/,BeginCommand:/<</,EndCommand:/>>/,Variable:/\$([A-Za-z0-9_.])+/,ShortcutOption:/->/,OptionStart:/\[\[/,OptionDelimit:/\|/,OptionEnd:/\]\]/,If:/if(?!\w)/,ElseIf:/elseif(?!\w)/,Else:/else(?!\w)/,EndIf:/endif(?!\w)/,Set:/set(?!\w)/,True:/true(?!\w)/,False:/false(?!\w)/,Null:/null(?!\w)/,LeftParen:/\(/,RightParen:/\)/,Comma:/,/,EqualTo:/(==|is(?!\w)|eq(?!\w))/,GreaterThan:/(>|gt(?!\w))/,GreaterThanOrEqualTo:/(>=|gte(?!\w))/,LessThan:/(<|lt(?!\w))/,LessThanOrEqualTo:/(<=|lte(?!\w))/,NotEqualTo:/(!=|neq(?!\w))/,Or:/(\|\||or(?!\w))/,And:/(&&|and(?!\w))/,Xor:/(\^|xor(?!\w))/,Not:/(!|not(?!\w))/,EqualToOrAssign:/(=|to(?!\w))/,Add:/\+/,Minus:/-/,Multiply:/\*/,Divide:/\//,AddAssign:/\+=/,MinusAssign:/-=/,MultiplyAssign:/\*=/,DivideAssign:/\/=/,Comment:"//",Identifier:/[a-zA-Z0-9_:.]+/,CommandCall:/([^>]|(?!>)[^>]+>)+(?=>>)/,Text:/.*/,BeginInlineExp:/\{/,EndInlineExp:/\}/};var s=class{constructor(){this.transitions=[],this.textRule=null,this.isTrackingNextIndentation=!1}addTransition(e,s,i){return this.transitions.push({token:e,regex:t[e],state:s||null,delimitsText:i||!1}),this}addTextRule(e,t){if(this.textRule)throw new Error("Cannot add more than one text rule to a state.");const s=[];this.transitions.forEach((e=>{e.delimitsText&&s.push(`(${e.regex.source})`)}));const i=`((?!${s.join("|")}).)*`;return this.addTransition(e,t),this.textRule=this.transitions[this.transitions.length-1],this.textRule.regex=new RegExp(i),this}setTrackNextIndentation(e){return this.isTrackingNextIndentation=e,this}};var i={makeStates:function(){return{base:(new s).addTransition("BeginCommand","command",!0).addTransition("OptionStart","option",!0).addTransition("BeginInlineExp","inlineExpression",!0).addTransition("ShortcutOption","shortcutOption").addTextRule("Text"),shortcutOption:(new s).setTrackNextIndentation(!0).addTransition("BeginCommand","expression",!0).addTextRule("Text","base"),command:(new s).addTransition("If","expression").addTransition("Else").addTransition("ElseIf","expression").addTransition("EndIf").addTransition("Set","assignment").addTransition("EndCommand","base",!0).addTransition("Identifier","commandOrExpression",!0).addTextRule("Text"),commandOrExpression:(new s).addTransition("EndCommand","base",!0).addTransition("LeftParen").addTransition("Variable").addTransition("Number").addTransition("String").addTransition("True").addTransition("False").addTransition("Identifier").addTransition("Comma").addTransition("RightParen"),assignment:(new s).addTransition("Variable").addTransition("EqualToOrAssign","expression").addTransition("AddAssign","expression").addTransition("MinusAssign","expression").addTransition("MultiplyAssign","expression").addTransition("DivideAssign","expression"),expression:(new s).addTransition("EndCommand","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("Minus").addTransition("Multiply").addTransition("Divide").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule(),option:(new s).addTransition("OptionEnd","base",!0).addTransition("OptionDelimit","optionDestination",!0).addTextRule("Text"),optionDestination:(new s).addTransition("Identifier").addTransition("OptionEnd","base"),inlineExpression:(new s).addTransition("EndInlineExp","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("Variable").addTransition("Add").addTransition("Minus").addTransition("Multiply").addTransition("Divide").addTextRule("Text","base")}}};var n=class{constructor(){this.states=i.makeStates(),this.state="base",this.originalText="",this.lines=[],this.indentation=[[0,!1]],this.shouldTrackNextIndentation=!1,this.previousLevelOfIndentation=0,this.reset()}reset(){this.yytext="",this.yylloc={first_column:1,first_line:1,last_column:1,last_line:1},this.yylineno=1}lex(){if(this.isAtTheEndOfText()){this.yytext="";const e=this.indentation.pop();return e&&e[1]?"Dedent":"EndOfInput"}return this.isAtTheEndOfLine()?this.isAtTheEndOfText()?"Invalid":this.lexNextLine():this.lexNextTokenOnCurrentLine()}lexNextTokenOnCurrentLine(){const e=this.getCurrentLineIndentation();if(this.shouldTrackNextIndentation&&e>this.previousLevelOfIndentation)return this.indentation.push([e,!0]),this.shouldTrackNextIndentation=!1,this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=e,this.yytext="","Indent";if(e<this.getLastRecordedIndentation()[0]){if(this.indentation.pop()[1])return this.yytext="",this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],"Dedent";this.lexNextTokenOnCurrentLine()}if(e===this.previousLevelOfIndentation&&1===this.yylloc.last_column&&(this.yylloc.last_column+=e),this.getCurrentLine().substring(this.yylloc.last_column-1).startsWith("//"))return this.lexNextLine();for(const t of this.getState().transitions){const s=this.getCurrentLine().substring(this.yylloc.last_column-1).match(t.regex);if(null===s||0!==s.index)continue;const i=s[0];this.yytext=this.getCurrentLine().substr(this.yylloc.last_column-1,i.length),"String"===t.token&&(this.yytext=this.yytext.substring(1,this.yytext.length-1).replace(/\\/g,"")),this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=i.length,t.state&&(this.setState(t.state),this.shouldTrackNextIndentation&&this.getLastRecordedIndentation()[0]<e&&this.indentation.push([e,!1]));const n=this.getCurrentLine().substring(this.yylloc.last_column-1).match(/^\s*/);return 0!==n.length&&(2==n[0].length?this.yylloc.last_column+=1:this.yylloc.last_column+=n[0].length),t.token}return"Invalid"}lexNextLine(){this.yylineno+=1;const e=this.getCurrentLine().replace(/\t/,"    ");return this.lines[this.yylineno-1]=e,this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],this.yytext="",this.yylloc={first_column:1,first_line:this.yylineno,last_column:1,last_line:this.yylineno},this.lex()}setState(e){if(void 0===this.states[e])throw new Error(`Cannot set the unknown state [${e}]`);this.state=e,this.getState().isTrackingNextIndentation&&(this.shouldTrackNextIndentation=!0)}setInput(e){this.originalText=e.replace(/(\r\n)/g,"\n").replace(/\r/g,"\n").replace(/[\n\r]+$/,""),this.lines=this.originalText.split("\n"),this.reset()}getState(){return this.states[this.state]}getCurrentLine(){return this.lines[this.yylineno-1]}setCurrentLine(e){this.lines[this.yylineno-1]=e}getCurrentLineIndentation(){const e=this.getCurrentLine().match(/^(\s*)/g);return null===e&&null===e[0]?0:e[0].length}getLastRecordedIndentation(){return 0===this.indentation.length?[0,!1]:this.indentation[this.indentation.length-1]}isAtTheEndOfText(){return this.isAtTheEndOfLine()&&this.yylloc.first_line>=this.lines.length}isAtTheEndOfLine(){return this.yylloc.last_column>this.getCurrentLine().length}};class r{}class o{}class a{}class l{}class h{}class u{}class d{}class c{}class p{}class y{}class f{}var x={types:{Text:r,Shortcut:o,Jump:a,Option:l,Conditional:h,Assignment:u,Literal:d,Expression:c,Command:y,FunctionCall:p,InlineExpression:f},RootNode:class{constructor(e){this.name="RootNode",this.dialogNodes=e||[]}},DialogNode:class{constructor(e,t){this.type="DialogNode",this.name=t||null,this.content=e}},DialogShortcutNode:class extends o{constructor(e,t,s){super(),this.type="DialogShortcutNode",this.text=e,this.content=t,this.lineNum=s?s.first_line:-1}},ConditionalDialogShortcutNode:class extends o{constructor(e,t,s,i){super(),this.type="ConditionalDialogShortcutNode",this.text=e,this.content=t,this.conditionalExpression=s,this.lineNum=i?i.first_line:-1}},IfNode:class extends h{constructor(e,t){super(),this.type="IfNode",this.expression=e,this.statement=t}},IfElseNode:class extends h{constructor(e,t,s){super(),this.type="IfElseNode",this.expression=e,this.statement=t,this.elseStatement=s}},ElseNode:class extends h{constructor(e){super(),this.type="ElseNode",this.statement=e}},ElseIfNode:class extends h{constructor(e,t,s){super(),this.type="ElseIfNode",this.expression=e,this.statement=t,this.elseStatement=s}},TextNode:class extends r{constructor(e,t){super(),this.type="TextNode",this.text=e,this.lineNum=t?t.first_line:-1}},JumpNode:class extends a{constructor(e,t){super(),this.type="JumpNode",this.identifier=e,this.lineNum=t?t.first_line:-1,this.selectable=!0}},OptionNode:class extends l{constructor(e,t,s){super(),this.type="OptionNode",this.text=e||null,this.identifier=t||this.text,this.lineNum=s?s.first_line:-1,this.selectable=!0}},NumericLiteralNode:class extends d{constructor(e){super(),this.type="NumericLiteralNode",this.numericLiteral=e}},StringLiteralNode:class extends d{constructor(e){super(),this.type="StringLiteralNode",this.stringLiteral=e}},BooleanLiteralNode:class extends d{constructor(e){super(),this.type="BooleanLiteralNode",this.booleanLiteral=e}},VariableNode:class extends d{constructor(e){super(),this.type="VariableNode",this.variableName=e}},UnaryMinusExpressionNode:class extends c{constructor(e){super(),this.type="UnaryMinusExpressionNode",this.expression=e}},ArithmeticExpressionNode:class extends c{constructor(e){super(),this.type="ArithmeticExpressionNode",this.expression=e}},ArithmeticExpressionAddNode:class extends c{constructor(e,t){super(),this.type="ArithmeticExpressionAddNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionMinusNode:class extends c{constructor(e,t){super(),this.type="ArithmeticExpressionMinusNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionMultiplyNode:class extends c{constructor(e,t){super(),this.type="ArithmeticExpressionMultiplyNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionDivideNode:class extends c{constructor(e,t){super(),this.type="ArithmeticExpressionDivideNode",this.expression1=e,this.expression2=t}},BooleanExpressionNode:class extends c{constructor(e){super(),this.type="BooleanExpressionNode",this.booleanExpression=e}},NegatedBooleanExpressionNode:class extends c{constructor(e){super(),this.type="NegatedBooleanExpressionNode",this.booleanExpression=e}},BooleanOrExpressionNode:class extends c{constructor(e,t){super(),this.type="BooleanOrExpressionNode",this.expression1=e,this.expression2=t}},BooleanAndExpressionNode:class extends c{constructor(e,t){super(),this.type="BooleanAndExpressionNode",this.expression1=e,this.expression2=t}},BooleanXorExpressionNode:class extends c{constructor(e,t){super(),this.type="BooleanXorExpressionNode",this.expression1=e,this.expression2=t}},EqualToExpressionNode:class extends c{constructor(e,t){super(),this.type="EqualToExpressionNode",this.expression1=e,this.expression2=t}},NotEqualToExpressionNode:class extends c{constructor(e,t){super(),this.type="EqualToExpressionNode",this.expression1=e,this.expression2=t}},GreaterThanExpressionNode:class extends c{constructor(e,t){super(),this.type="GreaterThanExpressionNode",this.expression1=e,this.expression2=t}},GreaterThanOrEqualToExpressionNode:class extends c{constructor(e,t){super(),this.type="GreaterThanOrEqualToExpressionNode",this.expression1=e,this.expression2=t}},LessThanExpressionNode:class extends c{constructor(e,t){super(),this.type="LessThanExpressionNode",this.expression1=e,this.expression2=t}},LessThanOrEqualToExpressionNode:class extends c{constructor(e,t){super(),this.type="LessThanOrEqualToExpressionNode",this.expression1=e,this.expression2=t}},SetVariableEqualToNode:class extends u{constructor(e,t){super(),this.type="SetVariableEqualToNode",this.variableName=e,this.expression=t}},SetVariableAddNode:class extends u{constructor(e,t){super(),this.type="SetVariableAddNode",this.variableName=e,this.expression=t}},SetVariableMinusNode:class extends u{constructor(e,t){super(),this.type="SetVariableMinusNode",this.variableName=e,this.expression=t}},SetVariableMultipyNode:class extends u{constructor(e,t){super(),this.type="SetVariableMultipyNode",this.variableName=e,this.expression=t}},SetVariableDivideNode:class extends u{constructor(e,t){super(),this.type="SetVariableDivideNode",this.variableName=e,this.expression=t}},FunctionResultNode:class extends p{constructor(e,t){super(),this.type="FunctionResultNode",this.functionName=e,this.args=t,this.lineNum=-1}},CommandNode:class extends y{constructor(e,t){super(),this.type="CommandNode",this.command=e,this.lineNum=t?t.first_line:-1}},InlineExpressionNode:class extends f{constructor(e,t){super(),this.type="InlineExpressionNode",this.expression=e,this.lineNum=t?t.first_line:-1}}};class E{}var m={Result:E,TextResult:class extends E{constructor(e,t,s){super(),this.text=e,this.data=t,this.lineNum=s}},CommandResult:class extends E{constructor(e,t,s){super(),this.name=e,this.args=t,this.result=s}},OptionsResult:class extends E{constructor(e,t){super(),this.options=e,this.lineNum=t,this.selected=-1}select(e){if(e<0||e>=this.options.length)throw new Error(`Cannot select option #${e}, there are only ${this.options.length} options`);this.selected=e}}};var g=class{constructor(){this.data={}}set(e,t){this.data[e]=t}get(e){return this.data[e]}};const N=e.parser;N.lexer=new n,N.yy=x;const T=x.types;return{Runner:class{constructor(){this.yarnNodes={},this.variables=new g,this.functions={},this.visited={},this.registerFunction("visited",(e=>!!this.visited[e[0]]))}load(e){for(const t of e)this.yarnNodes[t.title]={title:t.title,tags:t.tags,body:t.body}}loadYarnString(e){this.load(function(e){let t=[];var s=e.split(/\r?\n/),i=null,n=!1;for(let e=0;e<s.length;e++)if("==="===s[e].trim())n=!1,null!=i&&(i.body=i.body.substr(0,i.body.length-1),t.push(i),i=null);else if(n)i.body+=s[e]+"\n";else if(s[e].indexOf("title:")>-1)null==i&&(i={}),i.title=s[e].substr(7,s[e].length-7);else if(s[e].indexOf("position:")>-1){null==i&&(i={});var r=s[e].substr(9,s[e].length-9).split(",");i.position={x:Number(r[0].trim()),y:Number(r[1].trim())}}else s[e].indexOf("colorID:")>-1?(null==i&&(i={}),i.colorID=Number(s[e].substr(9,s[e].length-9).trim())):s[e].indexOf("tags:")>-1?(null==i&&(i={}),i.tags=s[e].substr(6,s[e].length-6)):"---"==s[e].trim()&&(n=!0,i.body="");return null!=i&&t.push(i),t}(e))}setVariableStorage(e){if("function"!=typeof e.set||"function"!=typeof e.get)throw new Error('Variable Storage object must contain both a "set" and "get" function');this.variables=e}registerFunction(e,t){if("function"!=typeof t)throw new Error("Registered function must be...well...a function");this.functions[e]=t}*run(e){const t=this.yarnNodes[e];if(void 0===t)throw new Error(`Node "${e}" does not exist`);this.visited[e]=!0;const s=Array.from(N.parse(t.body)),i={title:t.title,tags:t.tags.split(" "),body:t.body};yield*this.evalNodes(s,i)}*evalNodes(e,t){if(!e)return;let s=[],i=[],n=null,r=null;for(var o=0;o<e.length;o++){let u=e[o],d=e[o+1];if(n instanceof T.Shortcut&&!(u instanceof T.Shortcut)&&(yield*this.handleShortcuts(i,t),i=[]),u instanceof T.Jump)return void(yield*this.run(u.identifier));if(u instanceof T.Option)s.push(u);else if(u instanceof T.Text)r?(r.text+=u.text,null!=d&&d instanceof T.InlineExpression!=0&&u.lineNum===d.lineNum||(yield r,r=null)):d&&d instanceof T.InlineExpression&&u.lineNum===d.lineNum?r=new m.TextResult(u.text,t,u.lineNum):yield new m.TextResult(u.text,t,u.lineNum);else if(u instanceof T.InlineExpression){let e=this.evaluateExpressionOrLiteral(u.expression).toString();r?(r.text+=e,null!=d&&d instanceof T.Text!=0&&u.lineNum===d.lineNum||(yield r,r=null)):d&&d instanceof T.Text&&u.lineNum===d.lineNum?r=new m.TextResult(e,t,u.lineNum):yield new m.TextResult(e,t,u.lineNum)}else if(u instanceof T.Shortcut)i.push(u);else if(u instanceof T.Assignment)this.evaluateAssignment(u);else if(u instanceof T.Conditional){let e=this.evaluateConditional(u);if(e){e=e;let i=[];for(var a=0;a<e.length;a++)e[a]instanceof T.Option?s.push(e[a]):i.push(e[a]);yield*this.evalNodes(i,t)}}else if(u instanceof T.FunctionCall){if("stop"===u.functionName)return;var l=null,h=u.args?u.args.map(this.evaluateExpressionOrLiteral,this):[];this.functions[u.functionName]&&(l=this.functions[u.functionName](h)),yield new m.CommandResult(u.functionName,h,l)}n=u}i.length>0&&(yield*this.handleShortcuts(i,t)),s.length>0&&(yield*this.handleOptions(s))}*handleOptions(e){const t=new m.OptionsResult(e.map((e=>e.text)),e.map((e=>e.lineNum||-1)));if(yield t,-1!==t.selected){const s=e[t.selected];yield*this.run(s.identifier)}}*handleShortcuts(e,t){const s=e.filter((e=>"ConditionalDialogShortcutNode"!==e.type||this.evaluateExpressionOrLiteral(e.conditionalExpression)));if(0===s.length)return;const i=new m.OptionsResult(s.map((e=>e.text)),s.map((e=>e.lineNum||-1)));if(yield i,-1!==i.selected){const e=s[i.selected];e.content&&(yield*this.evalNodes(e.content,t))}}evaluateAssignment(e){let t=this.evaluateExpressionOrLiteral(e.expression);const s=this.variables.get(e.variableName);if("SetVariableAddNode"===e.type)t+=s;else if("SetVariableMinusNode"===e.type)t-=s;else if("SetVariableMultiplyNode"===e.type)t*=s;else if("SetVariableDivideNode"===e.type)t/=s;else if("SetVariableEqualToNode"!==e.type)throw new Error(`I don't recognize assignment type ${e.type}`);this.variables.set(e.variableName,t)}evaluateConditional(e){if("IfNode"===e.type){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement}else if("IfElseNode"===e.type||"ElseIfNode"===e.type){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement;if(e.elseStatement)return this.evaluateConditional(e.elseStatement)}else if("ElseNode"===e.type)return e.statement;return null}evaluateExpressionOrLiteral(e){if(e instanceof T.Expression){if("UnaryMinusExpressionNode"===e.type)return-1*this.evaluateExpressionOrLiteral(e.expression);if("ArithmeticExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression);if("ArithmeticExpressionAddNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)+this.evaluateExpressionOrLiteral(e.expression2);if("ArithmeticExpressionMinusNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)-this.evaluateExpressionOrLiteral(e.expression2);if("ArithmeticExpressionMultiplyNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)*this.evaluateExpressionOrLiteral(e.expression2);if("ArithmeticExpressionDivideNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)/this.evaluateExpressionOrLiteral(e.expression2);if("BooleanExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.booleanExpression);if("NegatedBooleanExpressionNode"===e.type)return!this.evaluateExpressionOrLiteral(e.booleanExpression);if("BooleanOrExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)||this.evaluateExpressionOrLiteral(e.expression2);if("BooleanAndExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)&&this.evaluateExpressionOrLiteral(e.expression2);if("BooleanXorExpressionNode"===e.type)return!this.evaluateExpressionOrLiteral(e.expression1)!=!this.evaluateExpressionOrLiteral(e.expression2);if("EqualToExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)===this.evaluateExpressionOrLiteral(e.expression2);if("NotEqualToExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)!==this.evaluateExpressionOrLiteral(e.expression2);if("GreaterThanExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)>this.evaluateExpressionOrLiteral(e.expression2);if("GreaterThanOrEqualToExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)>=this.evaluateExpressionOrLiteral(e.expression2);if("LessThanExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)<this.evaluateExpressionOrLiteral(e.expression2);if("LessThenOrEqualToExpressionNode"===e.type)return this.evaluateExpressionOrLiteral(e.expression1)<=this.evaluateExpressionOrLiteral(e.expression2);throw new Error(`I don't recognize expression type ${e.type}`)}if(e instanceof T.Text)return e.text;if(e instanceof T.Literal){if("NumericLiteralNode"===e.type)return parseFloat(e.numericLiteral);if("StringLiteralNode"===e.type)return e.stringLiteral;if("BooleanLiteralNode"===e.type)return"true"===e.booleanLiteral;if("VariableNode"===e.type)return this.variables.get(e.variableName);throw new Error(`I don't recognize literal type ${e.type}`)}if("FunctionResultNode"===e.type){if(this.functions[e.functionName])return this.functions[e.functionName](e.args.map(this.evaluateExpressionOrLiteral,this));throw new Error(`Function "${e.functionName}" not found`)}throw new Error(`I don't recognize expression/literal type ${e.type}`)}},TextResult:m.TextResult,CommandResult:m.CommandResult,OptionsResult:m.OptionsResult}}));