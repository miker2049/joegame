#!/usr/bin/env -S bash
# -*- mode: sh; -*-
BASE="/home/mik/joegame"
DENO_CMD="deno run --unstable -A $BASE/packages/mapscripts/src/cli/map-picture.deno.ts"
FC="$DENO_CMD $BASE/packages/mapscripts/src/world-settings.json $BASE/assets/maps/desert/desert-stamps2.json"
FHT=${2:-808}
FWI=${1:-1080}
HT=$(($FHT / 4))
WI=$(($FWI / 4))
# 1080/4 = 270, 808/4 = 202

echo "Starting first round"
$FC t_01.png 0 0 $WI $HT &
$FC t_05.png 0 $HT $WI $HT &
$FC t_09.png 0 $(($HT * 2)) $WI $HT &
$FC t_13.png 0 $(($HT * 3)) $WI $HT &
$FC t_02.png $WI 0 $WI $HT &
$FC t_06.png $WI $HT $WI $HT &
$FC t_10.png $WI $(($HT * 2)) $WI $HT &
$FC t_14.png $WI $(($HT * 3)) $WI $HT
wait
$FC t_03.png $(($WI * 2)) 0 $WI $HT &
$FC t_07.png $(($WI * 2)) $HT $WI $HT &
$FC t_11.png $(($WI * 2)) $(($HT * 2)) $WI $HT &
$FC t_15.png $(($WI * 2)) $(($HT * 3)) $WI $HT &
$FC t_04.png $(($WI * 3)) 0 $WI $HT &
$FC t_08.png $(($WI * 3)) $HT $WI $HT &
$FC t_12.png $(($WI * 3)) $(($HT * 2)) $WI $HT &
$FC t_16.png $(($WI * 3)) $(($HT * 3)) $WI $HT
wait

echo "ending second round, tiling pic"

magick montage t_*.png -tile 4x4 -geometry 1x1\< -compress Lossless -resize 100% -font monofur-Nerd-Font-Complete-Mono ${3:-mag.png}

echo "cleaning up $(echo t_*.png)"
rm t_*.png
