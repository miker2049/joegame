{"version":3,"sources":["../../src/actions/speakString.ts"],"names":["str","char","speakFunc","speed","Phaser","Geom","Rectangle","ContainsPoint","scene","cameras","main","getBounds","Point","x","y","words","split","wlength","length","ttime","globalDefaults","talkingSpeed","replace","match","i","syllable","syllableCount","randArr","randArrayAndSum","forEach","val","sum","arr","push","Math","random","reduce","pr","word","toLowerCase"],"mappings":";;;;;;;;;;;;;AAAA;;AAEA;;AACA;;;;;;;iFACe,kBAAeA,GAAf,EACXC,IADW,EAEXC,SAFW,EAGXC,KAHW;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gBAKLC,MAAM,CAACC,IAAP,CAAYC,SAAZ,CAAsBC,aAAtB,CAAoCN,IAAI,CAACO,KAAL,CAAWC,OAAX,CAAmBC,IAAnB,CAAwBC,SAAxB,EAApC,EAAyE,IAAIP,MAAM,CAACC,IAAP,CAAYO,KAAhB,CAAsBX,IAAI,CAACY,CAA3B,EAA8BZ,IAAI,CAACa,CAAnC,CAAzE,CALK;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAOLC,YAAAA,KAPK,GAOGf,GAAG,CAACgB,KAAJ,CAAU,GAAV,CAPH;AAQLC,YAAAA,OARK,GAQKF,KAAK,CAACG,MARX;AASLC,YAAAA,KATK,GASI,CAAChB,KAAD,aAACA,KAAD,cAACA,KAAD,GAAUiB,kBAAeC,YAAzB,IAAyCrB,GAAG,CAACsB,OAAJ,CAAY,GAAZ,EAAiB,EAAjB,EAAqBJ,MAA/D,GACT,oCAAClB,GAAG,CAACuB,KAAJ,CAAU,KAAV,CAAD,+CAAC,WAAkBL,MAAnB,iEAA6B,CAA7B,KAAmCE,kBAAeC,YAAf,GAA8B,GAAjE,CAVM;AAAA,0EAWFG,CAXE;AAAA;AAAA;AAAA;AAAA;AAAA;AAYDC,sBAAAA,QAZC,GAYUC,aAAa,CAACX,KAAK,CAACS,CAAD,CAAN,CAZvB;AAaDG,sBAAAA,OAbC,GAaSC,eAAe,CAACH,QAAD,CAbxB,EAcP;AAEA;;AACAE,sBAAAA,OAAO,CAAC,CAAD,CAAP,CAAWE,OAAX;AAAA,4GAAmB,iBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AACf5B,kCAAAA,SAAS;AADM;AAAA,yCAET,2BAAS4B,GAAG,GAAGH,OAAO,CAAC,CAAD,CAAd,IAAsBZ,KAAK,CAACS,CAAD,CAAL,CAASN,MAAT,GAAkBE,kBAAeC,YAAvD,CAAR,CAFS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAnB;;AAAA;AAAA;AAAA;AAAA;AAjBO;AAAA,6BAqBD,2BAAQD,kBAAeC,YAAf,GAA8B,GAAtC,CArBC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWFG,YAAAA,CAXE,GAWE,CAXF;;AAAA;AAAA,kBAWKA,CAAC,GAAGP,OAXT;AAAA;AAAA;AAAA;;AAAA,iDAWFO,CAXE;;AAAA;AAWkBA,YAAAA,CAAC,EAXnB;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AA0Bf,SAASI,eAAT,CAAyBV,MAAzB,EAA6D;AACzD,MAAIa,GAAG,GAAG,CAAV;AACA,MAAIC,GAAG,GAAG,EAAV;;AACA,OAAK,IAAIR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAApB,EAA4BM,CAAC,EAA7B,EAAiC;AAC7BQ,IAAAA,GAAG,CAACC,IAAJ,CAASC,IAAI,CAACC,MAAL,EAAT;AACH;;AACD,SAAO,CAACH,GAAD,EAAMA,GAAG,CAACI,MAAJ,CAAW,UAACC,EAAD,EAAKP,GAAL;AAAA,WAAaO,EAAE,GAAGP,GAAlB;AAAA,GAAX,CAAN,CAAP;AACH,C,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASJ,aAAT,CAAuBY,IAAvB,EAA6C;AAAA;;AACzCA,EAAAA,IAAI,GAAGA,IAAI,CAACC,WAAL,EAAP;;AACA,MAAID,IAAI,CAACpB,MAAL,IAAe,CAAnB,EAAsB;AAAE,WAAO,CAAP;AAAW;;AACnCoB,EAAAA,IAAI,GAAGA,IAAI,CAAChB,OAAL,CAAa,kCAAb,EAAiD,EAAjD,CAAP;AACAgB,EAAAA,IAAI,GAAGA,IAAI,CAAChB,OAAL,CAAa,IAAb,EAAmB,EAAnB,CAAP;AACA,8CAAOgB,IAAI,CAACf,KAAL,CAAW,gBAAX,CAAP,gDAAO,YAA8BL,MAArC,mEAA+C,CAA/C;AACH","sourcesContent":["import 'phaser'\nimport { ILevelComponents } from '../ILevel'\nimport timeout from '../utils/awaitTimeout'\nimport globalDefaults from '../defaults'\nexport default async function(str: string,\n    char: Phaser.GameObjects.Image,\n    speakFunc: (vol?: number, pan?: number) => void,\n    speed?: number\n): Promise<void> {\n    if (!(Phaser.Geom.Rectangle.ContainsPoint(char.scene.cameras.main.getBounds(), new Phaser.Geom.Point(char.x, char.y)))) return\n\n    const words = str.split(' ')\n    const wlength = words.length\n    const ttime = ((speed ?? globalDefaults.talkingSpeed) * str.replace(' ', '').length) +\n        ((str.match(/\\s/g)?.length ?? 0) * (globalDefaults.talkingSpeed * 1.7))\n    for (let i = 0; i < wlength; i++) {\n        const syllable = syllableCount(words[i])\n        const randArr = randArrayAndSum(syllable)\n        // for(let j = 0; j< syllable;j++){\n\n        // }\n        randArr[0].forEach(async (val) => {\n            speakFunc()\n            await timeout((val / randArr[1]) * (words[i].length * globalDefaults.talkingSpeed))\n        })\n        await timeout(globalDefaults.talkingSpeed * 1.7)\n    }\n    return\n}\n\nfunction randArrayAndSum(length: number): [number[], number] {\n    let sum = 0\n    let arr = []\n    for (let i = 0; i < length; i++) {\n        arr.push(Math.random())\n    }\n    return [arr, arr.reduce((pr, val) => pr + val)]\n}\n\n// https://dl.acm.org/doi/10.1145/10563.10583\n//  Each vowel (a, e, i, o, u, y) in a word counts as one syllable\n//  subject to the following sub-rules:\n// - Ignore final -ES, -ED, E (except for -LE)\n// - Words of three letters or less count as one syllable\n// - Consecutive vowels count as one syllable.\n//\n// https://stackoverflow.com/questions/5686483/how-to-compute-number-of-syllables-in-a-word-in-javascript\nfunction syllableCount(word: string): number {\n    word = word.toLowerCase();\n    if (word.length <= 3) { return 1; }\n    word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');\n    word = word.replace(/^y/, '');\n    return word.match(/[aeiouy]{1,2}/g)?.length ?? 1;\n}\n"],"file":"speakString.js"}