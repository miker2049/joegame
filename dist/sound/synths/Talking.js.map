{"version":3,"sources":["../../../src/sound/synths/Talking.ts"],"names":["envelope","attack","sustain","decay","root","fourth","third","fifth","maj7","intervals","VOICES","Talking","buffs","panner","Tone","Panner","toDestination","synths","i","push","Player","fadeIn","fadeOut","connect","init","then","ready","config","pan","set","currSynth","volume","value","vol","buffer","buff","length","Math","floor","random","interval","rate","playbackRate","console","log","start","now","cb","Offline","vowels","Promise","all","map","args","createBuff","_transport","vowelUgen","Frequency","toFrequency","f1","f2","f3","pitch","Volume","filtf1","Filter","Q","filtf2","filtf3","ampEnv","AmplitudeEnvelope","release","fan","noi","Noise","type","osc","Oscillator","frequency","triggerAttackRelease"],"mappings":";;;;;;;;;;;;;;;;;;;;;AACA;;AAIA,IAAMA,QAAQ,GAAG;AACbC,EAAAA,MAAM,EAAE,IADK;AAEbC,EAAAA,OAAO,EAAE,GAFI;AAGbC,EAAAA,KAAK,EAAE;AAHM,CAAjB;AAKA,IAAMC,IAAI,GAAG,MAAb,C,CAAoB;;AAEpB,IAAMC,MAAM,GAAG,MAAf;AACA,IAAMC,KAAK,GAAG,MAAd;AACA,IAAMC,KAAK,GAAG,GAAd;AACA,IAAMC,IAAI,GAAG,MAAb;AAEA,IAAMC,SAAS,GAAG,CAACL,IAAD,EAAOG,KAAP,EAAcA,KAAd,EAAqBD,KAArB,EAA4BE,IAA5B,CAAlB;AAEA,IAAME,MAAM,GAAG,CAAf;;IAQaC,O;AAQT,qBAAc;AAAA;;AAAA;AAAA,8CAPD,SAOC;AAAA,kDAHG,IAGH;AAAA,iDAFG,KAEH;AAAA,qDADM,CACN;AACV,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,MAAL,GAAc,IAAIC,IAAI,CAACC,MAAT,CAAgB,CAAhB,EAAmBC,aAAnB,EAAd;AACA,SAAKC,MAAL,GAAc,EAAd;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,MAApB,EAA4BQ,CAAC,EAA7B,EAAiC;AAC7B,WAAKD,MAAL,CAAYE,IAAZ,CAAiB,IAAIL,IAAI,CAACM,MAAT,CAAgB;AAAEC,QAAAA,MAAM,EAAE,KAAV;AAAiBC,QAAAA,OAAO,EAAE;AAA1B,OAAhB,EAAmDC,OAAnD,CAA2D,KAAKV,MAAhE,CAAjB;AACH;;AACD,SAAKW,IAAL,GAAYC,IAAZ,CAAiB;AAAA,aAAM,KAAI,CAACC,KAAL,GAAa,IAAnB;AAAA,KAAjB;AAEH;;;;WAED,cAAKC,MAAL,EAAiC;AAC7B,UAAI,KAAKD,KAAT,EAAgB;AAAA;;AACZ,YAAIC,MAAM,CAACC,GAAX,EAAgB,KAAKf,MAAL,CAAYgB,GAAZ,CAAgB;AAAED,UAAAA,GAAG,EAAED,MAAM,CAACC;AAAd,SAAhB,EADJ,CAEZ;;AACA,aAAKX,MAAL,CAAY,KAAKa,SAAjB,EAA4BC,MAA5B,CAAmCC,KAAnC,kBAA2CL,MAAM,CAACM,GAAlD,qDAAyD,CAAC,EAA1D;AACA,YAAMC,MAAM,kBAAG,KAAKtB,KAAL,CAAWe,MAAM,CAACQ,IAAP,GAAc,KAAKvB,KAAL,CAAWwB,MAApC,CAAH,qDAAkD,KAAKxB,KAAL,CAAWyB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB,KAAK3B,KAAL,CAAWwB,MAAtC,CAAX,CAA9D;AACA,aAAKnB,MAAL,CAAY,KAAKa,SAAjB,EAA4BI,MAA5B,GAAqCA,MAArC;AACA,YAAMM,QAAQ,GAAGb,MAAM,CAACc,IAAP,GAAehC,SAAS,CAACkB,MAAM,CAACc,IAAP,GAAchC,SAAS,CAAC2B,MAAzB,CAAT,GAA4ChC,IAA3D,GAAoEK,SAAS,CAAC4B,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB9B,SAAS,CAAC2B,MAArC,CAAD,CAAT,GAA0DhC,IAA/I;AACA,aAAKa,MAAL,CAAY,KAAKa,SAAjB,EAA4BY,YAA5B,GAA2CF,QAA3C;AACAG,QAAAA,OAAO,CAACC,GAAR,CAAYjB,MAAM,CAACc,IAAnB,EAAyBP,MAAzB,EAAiCM,QAAjC;AACA,aAAKvB,MAAL,CAAY,KAAKa,SAAjB,EAA4Be,KAA5B,CAAkC/B,IAAI,CAACgC,GAAL,KAAa,IAA/C;AACA,aAAKhB,SAAL,GAAiB,CAAC,KAAKA,SAAL,GAAiB,CAAlB,IAAuBpB,MAAxC;AACH;AACJ;;;WAED,qBAAY,CAAG;;;;gGAEf,iBAAyBqC,EAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACiBjC,IAAI,CAACkC,OAAL,CAAaD,EAAb,EAAiB,IAAjB,CADjB;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;0FAIA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACI;AACME,gBAAAA,MAFV,GAEmB,CACX,CAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAiB,EAAjB,CADW,EAEX,CAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAiB,EAAjB,CAFW,EAGX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CAHW,EAIX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CAJW,EAKX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CALW,EAMX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CANW,EAOX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CAPW,EAQX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CARW,EASX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CATW,EAUX,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,EAAkB,EAAlB,CAVW,CAFnB;AAcIC,gBAAAA,OAAO,CAACC,GAAR,CAA6BF,MAAM,CAACG,GAAP,CAAW,UAACC,IAAD,EAAoC;AACxE,yBAAO,MAAI,CAACC,UAAL,CAAgB,UAACC,UAAD,EAAgB;AAAE,oBAAA,MAAI,CAACC,SAAL,CAAeH,IAAI,CAAC,CAAD,CAAnB,EAAwBA,IAAI,CAAC,CAAD,CAA5B,EAAiCA,IAAI,CAAC,CAAD,CAArC,EAA0CvC,IAAI,CAAC2C,SAAL,CAAeJ,IAAI,CAAC,CAAD,CAAnB,EAAwB,MAAxB,EAAgCK,WAAhC,EAA1C;AAA0F,mBAA5H,CAAP;AACH,iBAF4B,CAA7B,EAEIjC,IAFJ,CAES,UAAAb,KAAK;AAAA,yBAAI,MAAI,CAACA,KAAL,GAAaA,KAAjB;AAAA,iBAFd;;AAdJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;WAmBA,mBAAkB+C,EAAlB,EAA8BC,EAA9B,EAA0CC,EAA1C,EAAsDC,KAAtD,EAAqE;AACjE;AACA,UAAM7B,GAAG,GAAG,IAAInB,IAAI,CAACiD,MAAT,CAAgB,CAAhB,EAAmB/C,aAAnB,EAAZ;AAEA,UAAMgD,MAAM,GAAG,IAAIlD,IAAI,CAACmD,MAAT,CAAgBN,EAAhB,EAAoB,UAApB,EAAgCpC,OAAhC,CAAwCU,GAAxC,CAAf;AACA+B,MAAAA,MAAM,CAACE,CAAP,CAASlC,KAAT,GAAiB,GAAjB;AAEA,UAAMmC,MAAM,GAAG,IAAIrD,IAAI,CAACmD,MAAT,CAAgBL,EAAhB,EAAoB,UAApB,EAAgCrC,OAAhC,CAAwCU,GAAxC,CAAf;AACAkC,MAAAA,MAAM,CAACD,CAAP,CAASlC,KAAT,GAAiB,IAAjB;AAEA,UAAMoC,MAAM,GAAG,IAAItD,IAAI,CAACmD,MAAT,CAAgBJ,EAAhB,EAAoB,UAApB,EAAgCtC,OAAhC,CAAwCU,GAAxC,CAAf;AACAmC,MAAAA,MAAM,CAACF,CAAP,CAASlC,KAAT,GAAiB,IAAjB;AAEA,UAAMqC,MAAM,GAAG,IAAIvD,IAAI,CAACwD,iBAAT,CAA2B;AACtCrE,QAAAA,MAAM,EAAE,GAD8B;AAEtCE,QAAAA,KAAK,EAAE,GAF+B;AAGtCD,QAAAA,OAAO,EAAE,GAH6B;AAItCqE,QAAAA,OAAO,EAAE;AAJ6B,OAA3B,EAKZC,GALY,CAKRR,MALQ,EAKAG,MALA,EAKQC,MALR,CAAf,CAbiE,CAoBjE;;AACA,UAAMK,GAAG,GAAG,IAAI3D,IAAI,CAAC4D,KAAT,CAAe;AACvBC,QAAAA,IAAI,EAAE,MADiB;AAEvB5C,QAAAA,MAAM,EAAE,CAAC;AAFc,OAAf,EAGTR,OAHS,CAGD8C,MAHC,EAGOxB,KAHP,EAAZ;AAKA,UAAM+B,GAAG,GAAG,IAAI9D,IAAI,CAAC+D,UAAT,CAAoB;AAC5BF,QAAAA,IAAI,EAAE,UADsB;AAE5BG,QAAAA,SAAS,EAAEhB,KAFiB;AAG5B/B,QAAAA,MAAM,EAAE,CAAC;AAHmB,OAApB,EAITR,OAJS,CAID8C,MAJC,EAIOxB,KAJP,EAAZ;AAMAwB,MAAAA,MAAM,CAACU,oBAAP,CAA4B,IAA5B;AACH","sourcesContent":["import { ITonerPlayConfig } from 'sound/IToner';\nimport * as Tone from 'tone'\nimport { ToneAudioBuffer } from 'tone';\nimport { ITonerSynth } from '../ITonerSynth';\n\nconst envelope = {\n    attack: 0.01,\n    sustain: 1.0,\n    decay: 0.01\n}\nconst root = 261.63 // G4\n\nconst fourth = 349.23\nconst third = 329.63\nconst fifth = 392\nconst maj7 = 493.88\n\nconst intervals = [root, fifth, fifth, third, maj7]\n\nconst VOICES = 8\n\nexport interface ITalkingPlayConfig extends ITonerPlayConfig {\n    inst: 'talking'\n    buff: number\n    rate: number\n}\n\nexport class Talking implements ITonerSynth {\n    id: string = 'talking'\n    synths: Tone.Player[]\n    panner: Tone.Panner\n    buffs: Tone.ToneAudioBuffer[]\n    volume: number = 0.75\n    ready: boolean = false\n    currSynth: number = 0\n    constructor() {\n        this.buffs = []\n        this.panner = new Tone.Panner(0).toDestination()\n        this.synths = []\n        for (let i = 0; i < VOICES; i++) {\n            this.synths.push(new Tone.Player({ fadeIn: 0.005, fadeOut: 0.005 }).connect(this.panner))\n        }\n        this.init().then(() => this.ready = true)\n\n    }\n\n    play(config: ITalkingPlayConfig) {\n        if (this.ready) {\n            if (config.pan) this.panner.set({ pan: config.pan })\n            // this.panner.set({ pan: (Math.random() * 2) - 1 })\n            this.synths[this.currSynth].volume.value = config.vol ?? -12\n            const buffer = this.buffs[config.buff % this.buffs.length] ?? this.buffs[Math.floor(Math.random() * this.buffs.length)]\n            this.synths[this.currSynth].buffer = buffer\n            const interval = config.rate ? (intervals[config.rate % intervals.length] / root) : (intervals[Math.floor(Math.random() * intervals.length)] / root)\n            this.synths[this.currSynth].playbackRate = interval\n            console.log(config.rate, buffer, interval);\n            this.synths[this.currSynth].start(Tone.now() + 0.01)\n            this.currSynth = (this.currSynth + 1) % VOICES\n        }\n    }\n\n    setVolume() { }\n\n    private async createBuff(cb: (context: Tone.OfflineContext) => void): Promise<ToneAudioBuffer> {\n        return await Tone.Offline(cb, 0.25)\n    }\n\n    async init() {\n        // https://soundbridge.io/formants-vowel-sounds/\n        const vowels = [\n            [570, 840, 2410, 60],\n            [300, 870, 2240, 60],\n            [440, 1020, 2240, 60],\n            [730, 1090, 2440, 60],\n            [520, 1190, 2390, 60],\n            [490, 1350, 1690, 60],\n            [660, 1720, 2410, 60],\n            [530, 1840, 2480, 60],\n            [390, 1990, 2550, 60],\n            [270, 2290, 3010, 60]\n        ]\n        Promise.all<ToneAudioBuffer>(vowels.map((args): Promise<ToneAudioBuffer> => {\n            return this.createBuff((_transport) => { this.vowelUgen(args[0], args[1], args[2], Tone.Frequency(args[3], \"midi\").toFrequency()) })\n        })).then(buffs => this.buffs = buffs)\n    }\n\n    private vowelUgen(f1: number, f2: number, f3: number, pitch: number) {\n        // https://github.com/benfordslaw/vowel-sound-generator/blob/main/sketch.js\n        const vol = new Tone.Volume(0).toDestination();\n\n        const filtf1 = new Tone.Filter(f1, \"bandpass\").connect(vol);\n        filtf1.Q.value = 5.0;\n\n        const filtf2 = new Tone.Filter(f2, \"bandpass\").connect(vol);\n        filtf2.Q.value = 13.0;\n\n        const filtf3 = new Tone.Filter(f3, \"bandpass\").connect(vol);\n        filtf3.Q.value = 14.0;\n\n        const ampEnv = new Tone.AmplitudeEnvelope({\n            attack: 0.1,\n            decay: 0.2,\n            sustain: 1.0,\n            release: 0.8\n        }).fan(filtf1, filtf2, filtf3);\n\n        //noise adds a little natural-ness\n        const noi = new Tone.Noise({\n            type: \"pink\",\n            volume: -16\n        }).connect(ampEnv).start()\n\n        const osc = new Tone.Oscillator({\n            type: \"sawtooth\",\n            frequency: pitch,\n            volume: -8\n        }).connect(ampEnv).start()\n\n        ampEnv.triggerAttackRelease(\"8t\");\n    }\n\n}\n"],"file":"Talking.js"}